{% extends "base.html" %}

{% block title %}Edit Expense - Expense Tracker{% endblock %}

{% block content %}
{% include 'nav_menu.html' %}

<div class="dashboard-wrapper">
    <section class="hero-section py-5 mb-5">
        <div class="container">
            <div class="row align-items-center justify-content-center text-center">
                <div class="col-lg-8 col-md-10">
                    <h1 class="hero-title mb-4">Edit Transaction</h1>
                    <p class="hero-subtitle mb-0">Update amount, category, or description</p>
                </div>
            </div>
        </div>
    </section>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-6 col-md-8">
                <div class="card edit-expense-card-compact h-auto">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">
                            <i class="bi bi-pencil-square me-2"></i>Edit Transaction
                        </h3>
                    </div>
                    <div class="card-body py-3">
                        <form method="POST" action="{{ url_for('edit_expense', expense_id=expense.id|default(0)) }}" id="editExpenseForm">
                            <!-- Original Info (Read-only) -->
                            <div class="row mb-3">
                                <div class="col-6">
                                    <div class="info-card-compact">
                                        <label class="info-label-compact">Original Date</label>
                                        <div class="info-value">
                                            {% if expense and expense.date %}
                                                {{ expense.date[:10] }}
                                            {% else %}
                                                No date
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="info-card-compact">
                                        <label class="info-label-compact">Original Category</label>
                                        <div class="info-value simple-category-text">
                                            {{ expense.category|default('N/A') }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Amount Field -->
                            <div class="row g-3 mb-3">
                                <div class="col-6">
                                    <label class="form-label fw-semibold mb-2">New Amount</label>
                                    <div class="input-group input-group-compact">
                                        <input type="number" 
                                               name="amount" 
                                               class="form-control form-control-lg" 
                                               value="{% if expense and expense.amount %}{{ expense.amount|float }}{% else %}0.00{% endif %}" 
                                               step="0.01" min="0" required>
                                        <span class="input-group-text bg-transparent border-start-0">â‚¨</span>
                                    </div>
                                </div>

                                <!-- Category Field -->
                                <div class="col-6">
                                    <label class="form-label fw-semibold mb-2">Category</label>
                                    <select name="category" class="form-select form-select-lg" required>
                                        {% set default_categories = ['Foods & Drink', 'Shopping', 'Transportation', 'Housing', 'Vehicle', 'Entertainment', 'Investments', 'Other'] %}
                                        {% for cat in categories|default(default_categories) %}
                                        <option value="{{ cat }}" 
                                                {% if cat == (expense.category|default('')) %}selected{% endif %}>
                                            {{ cat }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <!-- Description Field -->
                            <div class="mb-3">
                                <label class="form-label fw-semibold mb-2">Description</label>
                                <textarea name="description" 
                                          class="form-control" 
                                          rows="2" 
                                          placeholder="Enter transaction description (optional)">
                                    {{ expense.description|default('') }}
                                </textarea>
                            </div>

                            <!-- Action Buttons - TEXT ONLY -->
                            <div class="d-flex gap-2 justify-content-end">
                                <button type="submit" class="btn btn-primary btn-sm px-4 py-2 fw-semibold">
                                    Update Transaction
                                </button>
                                <a href="{{ url_for('all_records') }}" class="btn btn-outline-secondary btn-sm px-4 py-2">
                                    Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
:root {
    --blue-primary: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
    --blue-light: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
    --primary-blue: #2563eb;
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    --border-radius: 16px;
}

body {
    background: var(--blue-light);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    min-height: 100vh;
}

.hero-section { 
    background: var(--blue-primary); 
    color: white; 
    margin-bottom: 3rem; 
}

.hero-title { 
    font-weight: 800; 
    text-shadow: 0 1px 3px rgba(0,0,0,0.2); 
    font-size: 2.5rem; 
    margin: 0 auto;
    max-width: 600px;
}

.hero-subtitle { 
    font-size: 1.2rem; 
    opacity: 0.95; 
    max-width: 500px;
    margin: 0 auto;
}

.edit-expense-card-compact { 
    border-top: 4px solid var(--primary-blue); 
    max-width: 500px;
    margin: 0 auto;
}

.card {
    border: none;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    transition: all 0.3s ease;
    background: white;
}

.card:hover { box-shadow: var(--shadow-hover); transform: translateY(-2px); }

.card-header { 
    padding: 1rem 1.5rem; 
    border-bottom: 1px solid #e5e7eb; 
}

.card-title { 
    font-size: 1.25rem; 
    font-weight: 700; 
    color: #1f2937; 
    margin: 0; 
}

.card-body { padding: 1.5rem; }

/* Compact Original Info Cards */
.info-card-compact {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    padding: 1rem;
    border-radius: 10px;
    border-left: 3px solid var(--primary-blue);
}

.info-label-compact {
    font-size: 0.8rem;
    color: #64748b;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    margin-bottom: 0.25rem;
    display: block;
}

.info-value {
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
}

.simple-category-text {
    font-weight: 500;
    color: #475569;
}

/* Form Elements */
.form-control, .form-select {
    border-radius: 10px;
    border: 2px solid #e5e7eb;
    padding: 0.625rem 0.875rem;
    font-weight: 500;
    height: 48px;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 0.15rem rgba(37, 99, 235, 0.15);
}

.input-group-compact .input-group-text {
    background: var(--primary-blue) !important;
    color: white;
    border: none !important;
    font-weight: 600;
    border-radius: 0 10px 10px 0 !important;
}

/* Compact Buttons */
.btn-sm {
    padding: 0.5rem 1.25rem !important;
    font-size: 0.9rem !important;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
    min-height: 40px;
}

.btn-primary {
    background: var(--primary-blue);
    box-shadow: 0 2px 10px rgba(37, 99, 235, 0.25);
    border: none;
}

.btn-primary:hover {
    background: #1d4ed8;
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(37, 99, 235, 0.35);
}

.btn-outline-secondary {
    color: #6b7280;
    border: 2px solid #d1d5db;
}

.btn-outline-secondary:hover {
    background: #6b7280;
    color: white;
    transform: translateY(-1px);
}

/* Responsive */
@media (max-width: 768px) {
    .hero-title { font-size: 1.75rem; }
    .col-lg-6 { padding: 0 1rem; }
    .card-body { padding: 1.25rem !important; }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form validation and submission feedback
    const form = document.getElementById('editExpenseForm');
    const submitBtn = form.querySelector('button[type="submit"]');
    
    form.addEventListener('submit', function(e) {
        const amount = form.querySelector('input[name="amount"]').value;
        const category = form.querySelector('select[name="category"]').value;
        
        if (!amount || parseFloat(amount) <= 0) {
            e.preventDefault();
            alert('Please enter a valid amount greater than 0');
            return false;
        }
        
        if (!category) {
            e.preventDefault();
            alert('Please select a category');
            return false;
        }
        
        // Add loading state
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Updating...';
        
        setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalText;
        }, 3000);
    });

    // Auto-format amount input
    const amountInput = form.querySelector('input[name="amount"]');
    amountInput.addEventListener('input', function() {
        let value = parseFloat(this.value);
        if (value) {
            this.value = value.toFixed(2);
        }
    });
});
</script>
{% endblock %}
